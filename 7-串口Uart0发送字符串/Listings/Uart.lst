C51 COMPILER V9.56.0.0   UART                                                              10/29/2020 19:58:51 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\Uart.obj
COMPILER INVOKED BY: F:\Keil\C51\BIN\C51.EXE Uart.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\Uart.ls
                    -t) TABS(2) OBJECT(.\Objects\Uart.obj)

line level    source

   1          /*
   2           *  2020å¹´10æœˆ29æ—¥ 16ç‚¹24åˆ† â˜†4
   3           * 
   4           *  ä¸²å£é€šè®¯å®éªŒ2 â€”â€” ä½¿ç”¨å®šæ—¶å™¨ 2 äº§ç”Ÿä¸²å£æ—¶é’Ÿ
   5           *  
   6           *  æˆ‘é¦–å…ˆè¯•éªŒè¿‡ä¸²å£æ¨¡å¼ 0ï¼Œå‡ ä¹éƒ½å·²å¤±è´¥å‘Šç»ˆï¼Œç”±äºæ²¡æœ‰ä¾‹ç¨‹ï¼Œä¹Ÿæ— æ³•æ£€æŸ¥å‡ºé
             -”™è¯¯çš„æ ¹æºã€‚
   7           *  ä½¿ç”¨å®šæ—¶å™¨ T1 é©±åŠ¨ä¸²å£æ—¶å‘ç°è®¡æ•°å‘¨æœŸçŸ­äº†ï¼Œå‡ ä¹æ— æ³•ç”Ÿæˆä½æ³¢ç‰¹ç‡çš„æ—¶é’Ÿã€
             -‚
   8           *  è€Œå®šæ—¶å™¨ T2 æ˜¯ä¸€ä¸ªè‡ªåŠ¨é‡è½½çš„å®šæ—¶å™¨ï¼Œéå¸¸é€‚åˆç”¨ä½œ ä¸²å£Uart0 çš„æ—¶é’Ÿã€‚
   9           *  
  10          **/
  11          
  12          #include"CH559.H"
  13          #include<intrins.h>
  14          
  15          // è¿™æ˜¯ä¸€ä¸ªè®¡ç®—å…¬å¼ï¼Œä½†å…¶ä¸­çš„é™¤ä»¥ 16 æ˜¯ä»€ä¹ˆåŸå› æˆ‘è¿˜æ²¡å¼„æ˜ç™½ ğŸ¤·â€
  16          // 65535 = 0xFFFF æ˜¯ 16 ä½è®¡æ•°å™¨çš„æœ€å¤§è®¡æ•°å€¼
  17          // 12000000 = 12M æ˜¯æ™¶æŒ¯é¢‘ç‡
  18          // 9200 æ˜¯æˆ‘è®¾ç½®çš„ æ³¢ç‰¹ç‡(bps)
  19          // ä¸ºä»€ä¹ˆè¦é™¤ä»¥â—16å‘¢ï¼Ÿï¼Ÿï¼Ÿ
  20          unsigned int code baud = 65535 - 12000000/4/16/1200;
  21          
  22          void timer2_config(void){
  23   1      
  24   1        TH2       = (baud & 0xFF00) >> 8;
  25   1        TL2       = baud & 0x00FF;
  26   1        RCAP2H    = (baud & 0xFF00) >> 8;
  27   1        RCAP2L    = baud & 0x00FF;
  28   1      
  29   1        RCLK      = 1;   // é€‰æ‹© Timer2 äº§ç”Ÿæ—¶é’Ÿ
  30   1        TCLK      = 1;
  31   1      
  32   1        C_T2      = 0;  // ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ
  33   1        CP_RL2    = 0;  // ç”¨ä½œå®šæ—¶è€Œéè®¡æ•°
  34   1      
  35   1        TR2 = 1;        // å¯åŠ¨å®šæ—¶å™¨ T2
  36   1      
  37   1      //  bTMR_CLK = 0;
  38   1      //  bT2_CLK  = 0;
  39   1      
  40   1      }
  41          
  42          void uart0_config(void){
  43   1        SM0 = 0;
  44   1        SM1 = 1;
  45   1        SM2 = 1;
  46   1      
  47   1        REN = 1;
  48   1      }
  49          
  50          void interrupt_config(void){
  51   1      
  52   1        EA = 1;
C51 COMPILER V9.56.0.0   UART                                                              10/29/2020 19:58:51 PAGE 2   

  53   1        E_DIS = 0;
  54   1        ES = 1;
  55   1      
  56   1      }
  57          
  58          unsigned char i = 0;
  59          unsigned char txd_dat[64] = "ABCDEFG,HIJKLMN,OPQRST,UVWXYZ\n";
  60          unsigned char send_enable = 0;
  61          void main(void){
  62   1      
  63   1        interrupt_config();
  64   1        uart0_config();
  65   1        timer2_config();
  66   1        send_enable = 1;
  67   1        TI = 1;
  68   1        while(1);
  69   1      
  70   1      }
  71          
  72          void uart0_interrupt(void) interrupt 4 {
  73   1      
  74   1        if(TI){
  75   2          if(send_enable){
  76   3            if(txd_dat[i]!=NULL){
  77   4              SBUF = txd_dat[i];
  78   4              i++;
  79   4            }else{
  80   4              i = 0;
  81   4              send_enable = 0;
  82   4            }
  83   3      
  84   3          }
  85   2            TI = 0;
  86   2        }
  87   1        
  88   1        if(RI){
  89   2          RI = 0;
  90   2        }
  91   1      
  92   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    118    ----
   CONSTANT SIZE    =      2    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     66    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
